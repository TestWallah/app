<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ultimate 4K Street Racer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@900&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Montserrat', sans-serif;
            background: #000;
        }

        #game-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* --- MODERN GLASS UI --- */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .hud {
            display: flex;
            justify-content: space-between;
            padding: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 15px 30px;
            border-radius: 20px;
            color: #fff;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            min-width: 120px;
        }

        .stat-label {
            font-size: 12px;
            letter-spacing: 2px;
            opacity: 0.8;
            display: block;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 900;
        }

        /* --- MENU SCREENS --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0.8) 100%);
            z-index: 20;
            transition: opacity 0.5s;
        }

        .hidden { opacity: 0; pointer-events: none; }

        h1 {
            font-size: 70px;
            color: #fff;
            text-shadow: 0 0 20px #00ffff;
            margin-bottom: 30px;
            letter-spacing: 5px;
            text-align: center;
        }

        .play-btn {
            background: linear-gradient(45deg, #00f2fe, #4facfe);
            border: none;
            padding: 20px 60px;
            color: #fff;
            font-size: 24px;
            font-weight: 900;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .play-btn:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 15px 40px rgba(79, 172, 254, 0.7);
        }

        #boost-gauge {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            display: none;
            overflow: hidden;
        }

        #boost-fill {
            height: 100%;
            width: 100%;
            background: #00ffff;
            box-shadow: 0 0 20px #00ffff;
        }

    </style>
</head>
<body>

    <div id="game-container"></div>

    <div id="ui-layer">
        <div class="hud">
            <div class="stat-card">
                <span class="stat-label">SCORE</span>
                <span class="stat-value" id="score-text">0</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">HIGH SCORE</span>
                <span class="stat-value" id="high-score-text" style="color: #ffd700;">0</span>
            </div>
        </div>
        <div id="boost-gauge"><div id="boost-fill"></div></div>
    </div>

    <div id="start-screen" class="screen">
        <h1>STREET<br>KING 4K</h1>
        <button class="play-btn" onclick="initGame()">RACE START</button>
        <p style="color: #fff; margin-top: 20px; opacity: 0.6;">Swipe Left/Right to Control</p>
    </div>

    <div id="game-over-screen" class="screen hidden">
        <h1 style="color: #ff4757;">WASTED!</h1>
        <div class="stat-card" style="margin-bottom: 20px;">
            <span class="stat-label">FINAL SCORE</span>
            <span class="stat-value" id="final-score">0</span>
        </div>
        <button class="play-btn" onclick="initGame()">RETRY</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- ASSETS ---
        const PLAYER_URL = 'https://i.ibb.co/TDcsqmxX/1000-F-69908284-1zs-Id-LG3r-Wjy-BYj9-Hiu6l-Ao99-KYc-ZVOR-removebg-preview.png';
        const ENEMY_URL = 'https://i.ibb.co/CpZnCNCq/car-front-view-flat-illustration-white-background-947007-28148-removebg-preview.png';
        const COIN_URL = 'https://i.ibb.co/d3LvkB1/file-00000000d2987206bd36045dca44abee.png';
        const BOOST_URL = 'https://i.ibb.co/GQfHFX7z/file-0000000062c872069f12dac731f7b6fb.png';

        // --- VARS ---
        let scene, camera, renderer, player;
        let gameActive = false;
        let score = 0, highScore = localStorage.getItem('4kRacerHigh') || 0;
        let speed = 0.8, baseSpeed = 0.8;
        let lane = 1, targetX = 0;
        let boostLeft = 0;
        let gameObjects = [], scenery = [];
        const LANES = [-4, 0, 4];

        document.getElementById('high-score-text').innerText = highScore;

        function initScene() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x13132e); // Deep Midnight Blue
            scene.fog = new THREE.FogExp2(0x13132e, 0.012);

            camera = new THREE.PerspectiveCamera(65, window.innerWidth/window.innerHeight, 0.1, 250);
            camera.position.set(0, 6, 12);
            camera.lookAt(0, 2, -10);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio); // 4K resolution support
            document.getElementById('game-container').appendChild(renderer.domElement);

            // Lighting
            const ambient = new THREE.AmbientLight(0xffffff, 0.9);
            scene.add(ambient);

            const sun = new THREE.PointLight(0x00f2fe, 1, 100);
            sun.position.set(0, 10, 0);
            scene.add(sun);

            createPlayer();
            createEnvironment();
            
            // Interaction
            window.addEventListener('resize', onResize);
            setupControls();
            
            animate();
        }

        function createPlayer() {
            const tex = new THREE.TextureLoader().load(PLAYER_URL);
            const geo = new THREE.PlaneGeometry(3.5, 3.5);
            const mat = new THREE.MeshBasicMaterial({ map: tex, transparent: true });
            player = new THREE.Mesh(geo, mat);
            player.position.set(0, 1.7, 0);
            player.rotation.x = -0.15;
            scene.add(player);
        }

        function createEnvironment() {
            // High-Qual Road
            const roadGeo = new THREE.PlaneGeometry(16, 1000);
            const roadMat = new THREE.MeshStandardMaterial({ color: 0x111111, roughness: 0.8 });
            const road = new THREE.Mesh(roadGeo, roadMat);
            road.rotation.x = -Math.PI/2;
            road.position.z = -400;
            scene.add(road);

            // Sidewalk Neon Lines
            const lineGeo = new THREE.PlaneGeometry(0.2, 1000);
            const lineMat = new THREE.MeshBasicMaterial({ color: 0x00ffff });
            const lineL = new THREE.Mesh(lineGeo, lineMat);
            lineL.rotation.x = -Math.PI/2;
            lineL.position.set(-8, 0.05, -400);
            scene.add(lineL);
            
            const lineR = lineL.clone();
            lineR.position.x = 8;
            scene.add(lineR);
        }

        function spawnObject() {
            if(!gameActive) return;
            const r = Math.random();
            const laneIdx = Math.floor(Math.random()*3);
            const x = LANES[laneIdx];
            let obj;

            if(r < 0.6) { // Enemy Car
                const tex = new THREE.TextureLoader().load(ENEMY_URL);
                obj = new THREE.Mesh(new THREE.PlaneGeometry(3.2, 3.2), new THREE.MeshBasicMaterial({map: tex, transparent:true}));
                obj.userData = { type: 'enemy', lane: laneIdx };
                obj.position.set(x, 1.6, -120);
            } else if(r < 0.9) { // Coin
                const tex = new THREE.TextureLoader().load(COIN_URL);
                obj = new THREE.Mesh(new THREE.PlaneGeometry(2.2, 2.2), new THREE.MeshBasicMaterial({map: tex, transparent:true}));
                obj.userData = { type: 'coin', lane: laneIdx };
                obj.position.set(x, 2, -120);
            } else { // Boost
                const tex = new THREE.TextureLoader().load(BOOST_URL);
                obj = new THREE.Mesh(new THREE.PlaneGeometry(2.5, 2.5), new THREE.MeshBasicMaterial({map: tex, transparent:true}));
                obj.userData = { type: 'boost', lane: laneIdx };
                obj.position.set(x, 2, -120);
            }
            scene.add(obj);
            gameObjects.push(obj);
        }

        function spawnScenery() {
            const h = Math.random()*20 + 10;
            const geo = new THREE.BoxGeometry(5, h, 5);
            const colors = [0x1e272e, 0x485460, 0x05c46b, 0xff3f34, 0x3c40c6];
            const mat = new THREE.MeshStandardMaterial({color: colors[Math.floor(Math.random()*colors.length)]});
            const building = new THREE.Mesh(geo, mat);
            const side = Math.random() > 0.5 ? 1 : -1;
            building.position.set(side * 15, h/2, -150);
            scene.add(building);
            scenery.push(building);
        }

        function initGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            
            // Clean up
            gameObjects.forEach(o => scene.remove(o));
            scenery.forEach(s => scene.remove(s));
            gameObjects = []; scenery = [];
            
            score = 0;
            baseSpeed = 1.0;
            lane = 1;
            gameActive = true;
        }

        let spawnClock = 0;
        function animate() {
            requestAnimationFrame(animate);
            if(!gameActive) return;

            // Physics & Smooth Lane Change
            targetX = LANES[lane];
            player.position.x += (targetX - player.position.x) * 0.15;
            player.rotation.z = (player.position.x - targetX) * -0.1; // Body Roll

            // Boost logic
            let currentSpeed = baseSpeed;
            if(boostLeft > 0) {
                boostLeft--;
                currentSpeed *= 1.8;
                camera.fov += (75 - camera.fov) * 0.1;
                document.getElementById('boost-gauge').style.display = 'block';
                document.getElementById('boost-fill').style.width = (boostLeft/200)*100 + '%';
            } else {
                camera.fov += (65 - camera.fov) * 0.1;
                document.getElementById('boost-gauge').style.display = 'none';
            }
            camera.updateProjectionMatrix();

            // World movement
            score += currentSpeed;
            document.getElementById('score-text').innerText = Math.floor(score);
            baseSpeed += 0.0001;

            // Update Game Objects
            for(let i=gameObjects.length-1; i>=0; i--) {
                const o = gameObjects[i];
                o.position.z += currentSpeed * 1.5;

                // Coin/Boost Rotation
                if(o.userData.type !== 'enemy') o.rotation.y += 0.05;

                // Collision
                if(Math.abs(o.position.z - player.position.z) < 2) {
                    if(Math.abs(o.position.x - player.position.x) < 2.5) {
                        if(o.userData.type === 'enemy') {
                            endGame();
                        } else if(o.userData.type === 'coin') {
                            score += 500;
                            scene.remove(o);
                            gameObjects.splice(i, 1);
                        } else {
                            boostLeft = 200;
                            scene.remove(o);
                            gameObjects.splice(i, 1);
                        }
                    }
                }

                if(o.position.z > 20) {
                    scene.remove(o);
                    gameObjects.splice(i, 1);
                }
            }

            // Update Scenery
            for(let i=scenery.length-1; i>=0; i--) {
                const s = scenery[i];
                s.position.z += currentSpeed * 1.5;
                if(s.position.z > 20) {
                    scene.remove(s);
                    scenery.splice(i, 1);
                }
            }

            // Timers
            spawnClock++;
            if(spawnClock % 40 === 0) spawnObject();
            if(spawnClock % 15 === 0) spawnScenery();

            renderer.render(scene, camera);
        }

        function endGame() {
            gameActive = false;
            document.getElementById('game-over-screen').classList.remove('hidden');
            document.getElementById('final-score').innerText = Math.floor(score);
            if(score > highScore) {
                highScore = Math.floor(score);
                localStorage.setItem('4kRacerHigh', highScore);
                document.getElementById('high-score-text').innerText = highScore;
            }
        }

        function setupControls() {
            // Keyboard
            window.addEventListener('keydown', (e) => {
                if(e.key === 'ArrowLeft' && lane > 0) lane--;
                if(e.key === 'ArrowRight' && lane < 2) lane++;
            });

            // Touch
            let startX = 0;
            window.addEventListener('touchstart', (e) => startX = e.touches[0].clientX);
            window.addEventListener('touchend', (e) => {
                let diff = e.changedTouches[0].clientX - startX;
                if(diff < -40 && lane > 0) lane--;
                if(diff > 40 && lane < 2) lane++;
            });
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        initScene();
    </script>
</body>
</html>

