<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hindi Sahitya Quiz & Slap</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .shake-effect {
            animation: shake 0.5s;
            animation-iteration-count: 1;
            border: 5px solid red;
        }

        .slap-btn {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.4);
            transition: transform 0.1s;
        }
        .slap-btn:active {
            transform: scale(0.95);
        }
        .slap-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center font-sans" id="main-body">

    <!-- 1. ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® -->
    <div id="login-screen" class="w-full max-w-md p-6 bg-gray-800 rounded-xl shadow-2xl text-center">
        <h1 class="text-3xl font-bold mb-6 text-yellow-400">üìö ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø Quiz</h1>
        <p class="mb-4 text-gray-300">‡§µ‡§ø‡§∑‡§Ø: ‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§Ø‡•Å‡§ó ‡§î‡§∞ ‡§∂‡•Å‡§ï‡•ç‡§≤‡•ã‡§§‡•ç‡§§‡§∞ ‡§Ø‡•Å‡§ó</p>
        <div class="space-y-4">
            <input type="text" id="username" placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ" class="w-full p-3 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:border-yellow-400">
            <input type="text" id="roomId" placeholder="Room ID (e.g. class10)" class="w-full p-3 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:border-yellow-400">
            <button onclick="joinGame()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded transition">‡§ó‡•á‡§Æ ‡§ñ‡•á‡§≤‡•á‡§Ç (Join)</button>
        </div>
    </div>

    <!-- 2. ‡§µ‡•á‡§ü‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® -->
    <div id="waiting-screen" class="hidden w-full max-w-md p-6 bg-gray-800 rounded-xl text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-400 mx-auto mb-4"></div>
        <h2 class="text-xl font-semibold">‡§¶‡•Ç‡§∏‡§∞‡•á ‡§ñ‡§ø‡§≤‡§æ‡§°‡§º‡•Ä ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞...</h2>
        <p id="waiting-msg" class="text-gray-400 mt-2">Loading...</p>
    </div>

    <!-- 3. ‡§ó‡•á‡§Æ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® -->
    <div id="game-screen" class="hidden w-full max-w-lg p-4">
        <div class="flex justify-between items-center bg-gray-800 p-4 rounded-lg mb-6 border border-gray-700">
            <div class="text-center">
                <p id="p1-name-display" class="text-sm text-gray-400">P1</p>
                <p id="p1-score-display" class="text-2xl font-bold text-green-400">0</p>
            </div>
            <div class="text-2xl font-bold text-red-500">VS</div>
            <div class="text-center">
                <p id="p2-name-display" class="text-sm text-gray-400">P2</p>
                <p id="p2-score-display" class="text-2xl font-bold text-green-400">0</p>
            </div>
        </div>

        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6 relative">
            <span id="turn-indicator" class="absolute top-2 right-2 text-xs bg-blue-600 px-2 py-1 rounded">Q: <span id="q-number">1</span>/30</span>
            <h3 id="question-text" class="text-lg font-semibold mb-6 min-h-[60px]">Loading...</h3>
            
            <div id="options-container" class="grid grid-cols-1 gap-3"></div>
        </div>

        <div class="text-center">
            <button id="slap-btn" onclick="performSlap()" disabled class="slap-btn w-full py-4 rounded-xl text-2xl font-black text-white uppercase tracking-widest opacity-50">
                üëã SLAP!
            </button>
            <p id="action-status" class="mt-2 text-sm text-gray-400 h-5">‡§∏‡§π‡•Ä ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§Ç ‡§î‡§∞ ‡§•‡§™‡•ç‡§™‡•ú ‡§Æ‡§æ‡§∞‡•á‡§Ç!</p>
        </div>
    </div>

    <script>
        const API_URL = "https://sheetdb.io/api/v1/hkzyjglo32xu3";
        
        let gameState = {
            roomId: "",
            myPlayer: "",
            myName: "",
            opponentName: "",
            isGameRunning: false,
            currentQIndex: 0
        };

        // --- 30 ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® (‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§Ø‡•Å‡§ó ‡§î‡§∞ ‡§∂‡•Å‡§ï‡•ç‡§≤‡•ã‡§§‡•ç‡§§‡§∞ ‡§Ø‡•Å‡§ó) ---
        const questions = [
            // ‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§Ø‡•Å‡§ó (‡§õ‡§æ‡§Ø‡§æ‡§µ‡§æ‡§¶‡•Ä ‡§Ø‡•Å‡§ó)
            { q: "‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§Ø‡•Å‡§ó ‡§ï‡•Ä ‡§∏‡§Æ‡§Ø‡§æ‡§µ‡§ß‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡§æ‡§®‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à?", opts: ["1900-1920", "1919-1938", "1938-1947", "1850-1900"], ans: 1 },
            { q: "‚Äò‡§ö‡§ø‡§®‡•ç‡§§‡§æ‡§Æ‡§£‡§ø‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§∂‡•ç‡§Ø‡§æ‡§Æ‡§∏‡•Å‡§®‡•ç‡§¶‡§∞ ‡§¶‡§æ‡§∏", "‡§Ü‡§ö‡§æ‡§∞‡•ç‡§Ø ‡§∞‡§æ‡§Æ‡§ö‡§®‡•ç‡§¶‡•ç‡§∞ ‡§∂‡•Å‡§ï‡•ç‡§≤", "‡§ó‡•Å‡§≤‡§æ‡§¨‡§∞‡§æ‡§Ø"], ans: 2 },
            { q: "‚Äò‡§ó‡§¨‡§®‚Äô ‡§ï‡§ø‡§∏ ‡§µ‡§ø‡§ß‡§æ ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§®‡§æ‡§ü‡§ï", "‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏", "‡§ï‡§π‡§æ‡§®‡•Ä", "‡§ú‡•Ä‡§µ‡§®‡•Ä"], ans: 1 },
            { q: "‚Äò‡§ï‡§Ç‡§ï‡§æ‡§≤‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§ú‡§Ø‡§∂‡§Ç‡§ï‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§®‡§ø‡§∞‡§æ‡§≤‡§æ", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§∞‡§æ‡§Æ‡§ï‡•Å‡§Æ‡§æ‡§∞ ‡§µ‡§∞‡•ç‡§Æ‡§æ"], ans: 0 },
            { q: "‚Äò‡§ï‡§≤‡§Æ ‡§ï‡§æ ‡§∏‡§ø‡§™‡§æ‡§π‡•Ä‚Äô ‡§ï‡§ø‡§∏‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§µ‡•É‡§Ç‡§¶‡§æ‡§µ‡§®‡§≤‡§æ‡§≤ ‡§µ‡§∞‡•ç‡§Æ‡§æ", "‡§Ö‡§Æ‡•É‡§§‡§∞‡§æ‡§Ø", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§á‡§®‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç"], ans: 1 },
            { q: "‚Äò‡§™‡§Ç‡§ö‡§™‡§∞‡§Æ‡•á‡§∂‡•ç‡§µ‡§∞‚Äô ‡§ï‡§π‡§æ‡§®‡•Ä ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§Ü‡§ö‡§æ‡§∞‡•ç‡§Ø ‡§∂‡•Å‡§ï‡•ç‡§≤", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§Ø‡§∂‡§™‡§æ‡§≤", "‡§∞‡§æ‡§ú‡•á‡§®‡•ç‡§¶‡•ç‡§∞ ‡§Ø‡§æ‡§¶‡§µ"], ans: 1 },
            { q: "‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§Ø‡•Å‡§ó ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§ï‡§ø‡§∏ ‡§®‡§æ‡§Æ ‡§∏‡•á ‡§ú‡§æ‡§®‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à?", opts: ["‡§õ‡§æ‡§Ø‡§æ‡§µ‡§æ‡§¶ ‡§Ø‡•Å‡§ó", "‡§™‡•ç‡§∞‡§ó‡§§‡§ø‡§µ‡§æ‡§¶‡•Ä ‡§Ø‡•Å‡§ó", "‡§™‡•ç‡§∞‡§Ø‡•ã‡§ó‡§µ‡§æ‡§¶‡•Ä ‡§Ø‡•Å‡§ó", "‡§≠‡§æ‡§∞‡§§‡•á‡§®‡•ç‡§¶‡•Å ‡§Ø‡•Å‡§ó"], ans: 0 },
            { q: "‚Äò‡§∞‡§∏ ‡§Æ‡•Ä‡§Æ‡§æ‡§Ç‡§∏‡§æ‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§π‡•à‡§Ç?", opts: ["‡§Ü‡§ö‡§æ‡§∞‡•ç‡§Ø ‡§∞‡§æ‡§Æ‡§ö‡§®‡•ç‡§¶‡•ç‡§∞ ‡§∂‡•Å‡§ï‡•ç‡§≤", "‡§π‡§ú‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶ ‡§¶‡•ç‡§µ‡§ø‡§µ‡•á‡§¶‡•Ä", "‡§Æ‡§π‡§æ‡§¶‡•á‡§µ‡•Ä ‡§µ‡§∞‡•ç‡§Æ‡§æ", "‡§™‡§Ç‡§§"], ans: 0 },
            { q: "‚Äò‡§Æ‡•á‡§∞‡•Ä ‡§Ö‡§∏‡§´‡§≤‡§§‡§æ‡§è‡§Å‚Äô ‡§ï‡§ø‡§∏ ‡§µ‡§ø‡§ß‡§æ ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§ú‡•Ä‡§µ‡§®‡•Ä", "‡§Ü‡§§‡•ç‡§Æ‡§ï‡§•‡§æ", "‡§ï‡§π‡§æ‡§®‡•Ä", "‡§°‡§æ‡§Ø‡§∞‡•Ä"], ans: 1 },
            { q: "‚Äò‡§§‡§ø‡§§‡§≤‡•Ä‚Äô ‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡•á ‡§∞‡§ö‡§®‡§æ‡§ï‡§æ‡§∞ ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§ú‡§Ø‡§∂‡§Ç‡§ï‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§ú‡•à‡§®‡•á‡§Ç‡§¶‡•ç‡§∞", "‡§Ö‡§ú‡•ç‡§û‡•á‡§Ø"], ans: 0 },
            { q: "‚Äò‡§π‡§Ç‡§∏‚Äô ‡§™‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§ï‡•á ‡§∏‡§Æ‡•ç‡§™‡§æ‡§¶‡§ï ‡§ï‡•å‡§® ‡§•‡•á?", opts: ["‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§ú‡§Ø‡§∂‡§Ç‡§ï‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§Æ‡§π‡§æ‡§¶‡•á‡§µ‡•Ä ‡§µ‡§∞‡•ç‡§Æ‡§æ", "‡§®‡§ø‡§∞‡§æ‡§≤‡§æ"], ans: 0 },
            { q: "‚Äò‡§è‡§ï‡§æ‡§Ç‡§ï‡•Ä ‡§∏‡§Æ‡•ç‡§∞‡§æ‡§ü‚Äô ‡§ï‡§ø‡§∏‡•á ‡§ï‡§π‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à?", opts: ["‡§∞‡§æ‡§Æ‡§ï‡•Å‡§Æ‡§æ‡§∞ ‡§µ‡§∞‡•ç‡§Æ‡§æ", "‡§∏‡•á‡§† ‡§ó‡•ã‡§µ‡§ø‡§®‡•ç‡§¶ ‡§¶‡§æ‡§∏", "‡§π‡§∞‡§ø‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡•ç‡§∞‡•á‡§Æ‡•Ä", "‡§Æ‡•ã‡§π‡§® ‡§∞‡§æ‡§ï‡•á‡§∂"], ans: 0 },
            { q: "‚Äò‡§§‡•ç‡§Ø‡§æ‡§ó‡§™‡§§‡•ç‡§∞‚Äô ‡§ï‡§ø‡§∏ ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§ú‡•à‡§®‡•á‡§Ç‡§¶‡•ç‡§∞ ‡§ï‡•Å‡§Æ‡§æ‡§∞", "‡§Ö‡§ú‡•ç‡§û‡•á‡§Ø", "‡§ß‡§∞‡•ç‡§Æ‡§µ‡•Ä‡§∞ ‡§≠‡§æ‡§∞‡§§‡•Ä", "‡§´‡§£‡•Ä‡§∂‡•ç‡§µ‡§∞‡§®‡§æ‡§• ‡§∞‡•á‡§£‡•Å"], ans: 0 },
            { q: "‚Äò‡§ß‡•ç‡§∞‡•Å‡§µ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§®‡•Ä‚Äô ‡§®‡§æ‡§ü‡§ï ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§π‡•à‡§Ç?", opts: ["‡§π‡§∞‡§ø‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡•ç‡§∞‡•á‡§Æ‡•Ä", "‡§ú‡§Ø‡§∂‡§Ç‡§ï‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•ç‡§∞‡§≠‡§æ‡§ï‡§∞", "‡§Æ‡•ã‡§π‡§® ‡§∞‡§æ‡§ï‡•á‡§∂"], ans: 1 },
            { q: "‚Äò‡§Ö‡§∞‡•ç‡§¶‡•ç‡§ß‡§®‡§æ‡§∞‡•Ä‡§∂‡•ç‡§µ‡§∞‚Äô ‡§ï‡•á ‡§∞‡§ö‡§Ø‡§ø‡§§‡§æ ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§∞‡§æ‡§Æ‡§ß‡§æ‡§∞‡•Ä ‡§∏‡§ø‡§Ç‡§π ‡§¶‡§ø‡§®‡§ï‡§∞", "‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•ç‡§∞‡§≠‡§æ‡§ï‡§∞", "‡§¶‡•ã‡§®‡•ã‡§Ç (‡§Ö‡§≤‡§ó ‡§µ‡§ø‡§ß‡§æ)", "‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç"], ans: 1 }, // (Note: ‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•ç‡§∞‡§≠‡§æ‡§ï‡§∞ ‡§ï‡§æ ‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏ ‡§π‡•à, ‡§¶‡§ø‡§®‡§ï‡§∞ ‡§ï‡§æ ‡§®‡§ø‡§¨‡§Ç‡§ß‡•§ 10‡§µ‡•Ä‡§Ç ‡§∏‡•ç‡§§‡§∞ ‡§™‡§∞ ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•ç‡§∞‡§≠‡§æ‡§ï‡§∞ ‡§™‡•Ç‡§õ‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à, ‡§Ø‡§æ ‡§¶‡§ø‡§®‡§ï‡§∞) - ‡§Ø‡§π‡§æ‡§Å ‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•ç‡§∞‡§≠‡§æ‡§ï‡§∞ ‡§∏‡§π‡•Ä ‡§Æ‡§æ‡§® ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§
            
            // ‡§∂‡•Å‡§ï‡•ç‡§≤‡•ã‡§§‡•ç‡§§‡§∞ ‡§Ø‡•Å‡§ó (‡§õ‡§æ‡§Ø‡§æ‡§µ‡§æ‡§¶‡•ã‡§§‡•ç‡§§‡§∞ ‡§Ø‡•Å‡§ó)
            { q: "‡§∂‡•Å‡§ï‡•ç‡§≤‡•ã‡§§‡•ç‡§§‡§∞ ‡§Ø‡•Å‡§ó ‡§ï‡•Ä ‡§∏‡§Æ‡§Ø‡§æ‡§µ‡§ß‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["1938-1947", "1919-1938", "1900-1922", "1947-‡§Ö‡§¨ ‡§§‡§ï"], ans: 0 },
            { q: "‚Äò‡§ó‡•Å‡§®‡§æ‡§π‡•ã‡§Ç ‡§ï‡§æ ‡§¶‡•á‡§µ‡§§‡§æ‚Äô ‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§ß‡§∞‡•ç‡§Æ‡§µ‡•Ä‡§∞ ‡§≠‡§æ‡§∞‡§§‡•Ä", "‡§ï‡§Æ‡§≤‡•á‡§∂‡•ç‡§µ‡§∞", "‡§Æ‡•Å‡§Ç‡§∂‡•Ä ‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§Ö‡§Æ‡•É‡§§‡§≤‡§æ‡§≤ ‡§®‡§æ‡§ó‡§∞"], ans: 0 },
            { q: "‚Äò‡§∏‡•Ç‡§∞‡§ú ‡§ï‡§æ ‡§∏‡§æ‡§§‡§µ‡§æ‡§Å ‡§ò‡•ã‡§°‡§º‡§æ‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§π‡•à‡§Ç?", opts: ["‡§Æ‡•ã‡§π‡§® ‡§∞‡§æ‡§ï‡•á‡§∂", "‡§ß‡§∞‡•ç‡§Æ‡§µ‡•Ä‡§∞ ‡§≠‡§æ‡§∞‡§§‡•Ä", "‡§Ö‡§ú‡•ç‡§û‡•á‡§Ø", "‡§Ø‡§∂‡§™‡§æ‡§≤"], ans: 1 },
            { q: "‚Äò‡§¨‡§æ‡§£‡§≠‡§ü‡•ç‡§ü ‡§ï‡•Ä ‡§Ü‡§§‡•ç‡§Æ‡§ï‡§•‡§æ‚Äô ‡§ï‡§ø‡§∏ ‡§µ‡§ø‡§ß‡§æ ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§Ü‡§§‡•ç‡§Æ‡§ï‡§•‡§æ", "‡§ú‡•Ä‡§µ‡§®‡•Ä", "‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏", "‡§∞‡•á‡§ñ‡§æ‡§ö‡§ø‡§§‡•ç‡§∞"], ans: 2 },
            { q: "‚Äò‡§Ö‡§§‡•Ä‡§§ ‡§ï‡•á ‡§ö‡§≤‡§ö‡§ø‡§§‡•ç‡§∞‚Äô ‡§ï‡•Ä ‡§≤‡•á‡§ñ‡§ø‡§ï‡§æ ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§∏‡•Å‡§≠‡§¶‡•ç‡§∞‡§æ ‡§ï‡•Å‡§Æ‡§æ‡§∞‡•Ä ‡§ö‡•å‡§π‡§æ‡§®", "‡§Æ‡§π‡§æ‡§¶‡•á‡§µ‡•Ä ‡§µ‡§∞‡•ç‡§Æ‡§æ", "‡§Æ‡§®‡•ç‡§®‡•Ç ‡§≠‡§Ç‡§°‡§æ‡§∞‡•Ä", "‡§ï‡•É‡§∑‡•ç‡§£‡§æ ‡§∏‡•ã‡§¨‡§§‡•Ä"], ans: 1 },
            { q: "‚Äò‡§ó‡•á‡§π‡•Ç‡§Å ‡§î‡§∞ ‡§ó‡•Å‡§≤‡§æ‡§¨‚Äô ‡§ï‡•á ‡§∞‡§ö‡§®‡§æ‡§ï‡§æ‡§∞ ‡§π‡•à‡§Ç?", opts: ["‡§∞‡§æ‡§Æ‡§µ‡•É‡§ï‡•ç‡§∑ ‡§¨‡•á‡§®‡•Ä‡§™‡•Å‡§∞‡•Ä", "‡§Æ‡§π‡§æ‡§¶‡•á‡§µ‡•Ä ‡§µ‡§∞‡•ç‡§Æ‡§æ", "‡§∞‡§æ‡§Æ‡§µ‡§ø‡§≤‡§æ‡§∏ ‡§∂‡§∞‡•ç‡§Æ‡§æ", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶"], ans: 0 },
            { q: "‚Äò‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§≤‡•ã‡§ö‡§®‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§∂‡•ç‡§Ø‡§æ‡§Æ‡§∏‡•Å‡§®‡•ç‡§¶‡§∞ ‡§¶‡§æ‡§∏", "‡§∞‡§æ‡§Æ‡§ö‡§®‡•ç‡§¶‡•ç‡§∞ ‡§∂‡•Å‡§ï‡•ç‡§≤", "‡§π‡§ú‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶ ‡§¶‡•ç‡§µ‡§ø‡§µ‡•á‡§¶‡•Ä", "‡§®‡§ó‡•á‡§®‡•ç‡§¶‡•ç‡§∞"], ans: 0 },
            { q: "‚Äò‡§Æ‡•à‡§≤‡§æ ‡§Ü‡§Å‡§ö‡§≤‚Äô ‡§ï‡•á ‡§∞‡§ö‡§®‡§æ‡§ï‡§æ‡§∞ ‡§π‡•à‡§Ç?", opts: ["‡§´‡§£‡•Ä‡§∂‡•ç‡§µ‡§∞‡§®‡§æ‡§• ‡§∞‡•á‡§£‡•Å", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§Ö‡§Æ‡•É‡§§‡§∞‡§æ‡§Ø", "‡§®‡§æ‡§ó‡§æ‡§∞‡•ç‡§ú‡•Å‡§®"], ans: 0 },
            { q: "‚Äò‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§î‡§∞ ‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø‚Äô ‡§ï‡§ø‡§∏‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§°‡•â. ‡§∞‡§æ‡§ú‡•á‡§®‡•ç‡§¶‡•ç‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§Æ‡§π‡§æ‡§§‡•ç‡§Æ‡§æ ‡§ó‡§æ‡§Ç‡§ß‡•Ä", "‡§ú‡§µ‡§æ‡§π‡§∞‡§≤‡§æ‡§≤ ‡§®‡•á‡§π‡§∞‡•Ç", "‡§µ‡§ø‡§®‡•ã‡§¨‡§æ ‡§≠‡§æ‡§µ‡•á"], ans: 0 },
            { q: "‚Äò‡§π‡§ø‡§Æ‡§æ‡§≤‡§Ø ‡§ï‡•Ä ‡§™‡•Å‡§ï‡§æ‡§∞‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§π‡•à‡§Ç?", opts: ["‡§ú‡§Ø‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§≠‡§æ‡§∞‡§§‡•Ä", "‡§ß‡§∞‡•ç‡§Æ‡§µ‡•Ä‡§∞ ‡§≠‡§æ‡§∞‡§§‡•Ä", "‡§∞‡§æ‡§Æ‡§ß‡§æ‡§∞‡•Ä ‡§∏‡§ø‡§Ç‡§π ‡§¶‡§ø‡§®‡§ï‡§∞", "‡§≠‡§ó‡§µ‡§§‡§∂‡§∞‡§£ ‡§â‡§™‡§æ‡§ß‡•ç‡§Ø‡§æ‡§Ø"], ans: 0 },
            { q: "‚Äò‡§Ö‡§ú‡§æ‡§§‡§∂‡§§‡•ç‡§∞‡•Å‚Äô ‡§®‡§æ‡§ü‡§ï ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§ú‡§Ø‡§∂‡§Ç‡§ï‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§π‡§∞‡§ø‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡•ç‡§∞‡•á‡§Æ‡•Ä", "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Æ‡•Ä ‡§®‡§æ‡§∞‡§æ‡§Ø‡§£ ‡§Æ‡§ø‡§∂‡•ç‡§∞", "‡§â‡§™‡•á‡§Ç‡§¶‡•ç‡§∞‡§®‡§æ‡§• ‡§Ö‡§∂‡•ç‡§ï"], ans: 0 },
            { q: "‚Äò‡§ï‡•ç‡§Ø‡§æ ‡§≠‡•Ç‡§≤‡•Ç‡§Å ‡§ï‡•ç‡§Ø‡§æ ‡§Ø‡§æ‡§¶ ‡§ï‡§∞‡•Ç‡§Å‚Äô ‡§ï‡§ø‡§∏ ‡§µ‡§ø‡§ß‡§æ ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§°‡§æ‡§Ø‡§∞‡•Ä", "‡§∏‡§Ç‡§∏‡•ç‡§Æ‡§∞‡§£", "‡§Ü‡§§‡•ç‡§Æ‡§ï‡§•‡§æ", "‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ‡§µ‡•É‡§§‡•ç‡§§"], ans: 2 },
            { q: "‚Äò‡§®‡•Ä‡§°‡§º ‡§ï‡§æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ ‡§´‡§ø‡§∞‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§π‡§∞‡§ø‡§µ‡§Ç‡§∂‡§∞‡§æ‡§Ø ‡§¨‡§ö‡•ç‡§ö‡§®", "‡§¶‡§ø‡§®‡§ï‡§∞", "‡§™‡§Ç‡§§", "‡§®‡§ø‡§∞‡§æ‡§≤‡§æ"], ans: 0 },
            { q: "‚Äò‡§ù‡§≤‡§Æ‡§≤‡§æ‚Äô ‡§ï‡§ø‡§∏‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§™‡§¶‡•Å‡§Æ‡§≤‡§æ‡§≤ ‡§™‡•Å‡§®‡•ç‡§®‡§æ‡§≤‡§æ‡§≤ ‡§¨‡§ñ‡•ç‡§∂‡•Ä", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§ú‡§Ø‡§∂‡§Ç‡§ï‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§Ö‡§ú‡•ç‡§û‡•á‡§Ø"], ans: 0 },
            { q: "‚Äò‡§Ü‡§µ‡§æ‡§∞‡§æ ‡§Æ‡§∏‡•Ä‡§π‡§æ‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•ç‡§∞‡§≠‡§æ‡§ï‡§∞", "‡§Ö‡§Æ‡•É‡§§‡§∞‡§æ‡§Ø", "‡§∞‡§æ‡§Ç‡§ó‡•á‡§Ø ‡§∞‡§æ‡§ò‡§µ", "‡§∞‡§æ‡§π‡•Å‡§≤ ‡§∏‡§æ‡§Ç‡§ï‡•É‡§§‡•ç‡§Ø‡§æ‡§Ø‡§®"], ans: 0 }
        ];

        async function getGameData(roomId) {
            try {
                const response = await fetch(`${API_URL}/search?room_id=${roomId}`);
                const data = await response.json();
                return data.length > 0 ? data[0] : null;
            } catch (error) { console.error(error); return null; }
        }

        async function updateGameData(roomId, dataObj) {
            try {
                await fetch(`${API_URL}/room_id/${roomId}`, {
                    method: 'PATCH',
                    headers: { 'Accept': 'application/json', 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: dataObj })
                });
            } catch (error) { console.error(error); }
        }

        async function joinGame() {
            const name = document.getElementById('username').value.trim();
            const room = document.getElementById('roomId').value.trim();
            if (!name || !room) { Swal.fire('Error', '‡§®‡§æ‡§Æ ‡§î‡§∞ Room ID ‡§≠‡§∞‡•á‡§Ç', 'error'); return; }

            gameState.myName = name;
            gameState.roomId = room;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('waiting-screen').classList.remove('hidden');

            const roomData = await getGameData(room);

            if (!roomData) {
                gameState.myPlayer = 'player_1';
                document.getElementById('waiting-msg').innerText = "‡§∞‡•Ç‡§Æ ‡§¨‡§® ‡§∞‡§π‡§æ ‡§π‡•à...";
                await fetch(API_URL, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: [{ room_id: room, player_1_name: name, player_2_name: "", player_1_action: "none", player_2_action: "none", p1_score: 0, p2_score: 0, current_question_index: 0 }] })
                });
                startPolling();
            } else if (roomData.player_2_name === "") {
                gameState.myPlayer = 'player_2';
                document.getElementById('waiting-msg').innerText = "‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...";
                await updateGameData(room, { player_2_name: name });
                startPolling();
            } else {
                Swal.fire('Error', '‡§∞‡•Ç‡§Æ ‡§´‡•Å‡§≤ ‡§π‡•à', 'warning');
                location.reload();
            }
        }

        function startPolling() {
            setInterval(async () => {
                const data = await getGameData(gameState.roomId);
                if (data) handleSync(data);
            }, 2000);
        }

        function handleSync(data) {
            if (data.player_1_name && data.player_2_name && !gameState.isGameRunning) {
                gameState.isGameRunning = true;
                gameState.opponentName = (gameState.myPlayer === 'player_1') ? data.player_2_name : data.player_1_name;
                document.getElementById('waiting-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                document.getElementById('p1-name-display').innerText = data.player_1_name;
                document.getElementById('p2-name-display').innerText = data.player_2_name;
            }
            if (!gameState.isGameRunning) return;

            document.getElementById('p1-score-display').innerText = data.p1_score;
            document.getElementById('p2-score-display').innerText = data.p2_score;

            const serverQIndex = parseInt(data.current_question_index) || 0;
            if (serverQIndex !== gameState.currentQIndex) {
                gameState.currentQIndex = serverQIndex;
                loadQuestion(serverQIndex);
                disableSlapBtn(); 
            } else if (document.getElementById('question-text').innerText === "Loading...") {
                loadQuestion(serverQIndex);
            }
            checkIncomingSlap(data);
        }

        function loadQuestion(index) {
            document.getElementById('q-number').innerText = index + 1;
            if (index >= questions.length) {
                document.getElementById('question-text').innerText = "üéâ ‡§ó‡•á‡§Æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§! ‡§∏‡•ç‡§ï‡•ã‡§∞ ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§";
                document.getElementById('options-container').innerHTML = "";
                return;
            }
            const q = questions[index];
            document.getElementById('question-text').innerText = q.q;
            const optsDiv = document.getElementById('options-container');
            optsDiv.innerHTML = "";
            q.opts.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-3 bg-gray-700 hover:bg-gray-600 rounded border border-gray-600 transition";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i, q.ans);
                optsDiv.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct) {
            const status = document.getElementById('action-status');
            const optsDiv = document.getElementById('options-container');
            if (selected === correct) {
                status.innerText = "‚úÖ ‡§∏‡§π‡•Ä! Slap ‡§¨‡§ü‡§® ‡§¶‡§¨‡§æ‡§ì!";
                status.className = "mt-2 text-sm text-green-400 font-bold h-5";
                const slapBtn = document.getElementById('slap-btn');
                slapBtn.disabled = false;
                slapBtn.classList.remove('opacity-50');
                Array.from(optsDiv.children).forEach(b => b.disabled = true);
            } else {
                status.innerText = "‚ùå ‡§ó‡§≤‡§§! ‡§Æ‡•å‡§ï‡§æ ‡§ö‡•Ç‡§ï ‡§ó‡§è‡•§";
                status.className = "mt-2 text-sm text-red-400 h-5";
                Array.from(optsDiv.children).forEach(b => b.disabled = true);
            }
        }

        async function performSlap() {
            disableSlapBtn();
            document.getElementById('action-status').innerText = "Sending Slap...";
            let updates = {};
            if (gameState.myPlayer === 'player_1') {
                updates = { player_1_action: 'slap', p1_score: parseInt(document.getElementById('p1-score-display').innerText) + 10, current_question_index: gameState.currentQIndex + 1 };
            } else {
                updates = { player_2_action: 'slap', p2_score: parseInt(document.getElementById('p2-score-display').innerText) + 10, current_question_index: gameState.currentQIndex + 1 };
            }
            await updateGameData(gameState.roomId, updates);
        }

        async function checkIncomingSlap(data) {
            let opponentAction = (gameState.myPlayer === 'player_1') ? data.player_2_action : data.player_1_action;
            let resetKey = (gameState.myPlayer === 'player_1') ? "player_2_action" : "player_1_action";

            if (opponentAction === 'slap') {
                const body = document.getElementById('main-body');
                body.classList.add('shake-effect');
                Swal.fire({ icon: 'error', title: 'Thappad!', text: `${gameState.opponentName} ‡§®‡•á ‡§•‡§™‡•ç‡§™‡§°‡§º ‡§Æ‡§æ‡§∞‡§æ!`, timer: 1000, showConfirmButton: false, toast: true, position: 'top-end' });
                setTimeout(() => { body.classList.remove('shake-effect'); }, 600);
                let resetUpdate = {}; resetUpdate[resetKey] = "none";
                await updateGameData(gameState.roomId, resetUpdate);
            }
        }

        function disableSlapBtn() {
            const btn = document.getElementById('slap-btn');
            btn.disabled = true;
            btn.classList.add('opacity-50');
            document.getElementById('action-status').innerText = "‡§∏‡§π‡•Ä ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§Ç ‡§î‡§∞ ‡§•‡§™‡•ç‡§™‡•ú ‡§Æ‡§æ‡§∞‡•á‡§Ç!";
            document.getElementById('action-status').className = "mt-2 text-sm text-gray-400 h-5";
        }
    </script>
</body>
</html>


