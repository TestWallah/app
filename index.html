<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hindi Sahitya Quiz & Slap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translate(0,0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-5px, 0); }
            20%, 40%, 60%, 80% { transform: translate(5px, 0); }
        }
        .shake-effect { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; border: 4px solid red; }
        .slap-btn { background: linear-gradient(45deg, #ff416c, #ff4b2b); transition: 0.2s; }
        .slap-btn:active { transform: scale(0.9); }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center p-4" id="main-body">

    <!-- Login -->
    <div id="login-screen" class="w-full max-w-md bg-slate-800 p-8 rounded-2xl shadow-2xl border border-slate-700">
        <h1 class="text-3xl font-black text-center mb-2 text-yellow-400">CLASS 10 HINDI</h1>
        <p class="text-center text-slate-400 mb-8">‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§è‡§µ‡§Ç ‡§∂‡•Å‡§ï‡•ç‡§≤‡•ã‡§§‡•ç‡§§‡§∞ ‡§Ø‡•Å‡§ó</p>
        <input type="text" id="username" placeholder="‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ" class="w-full p-4 bg-slate-700 rounded-lg mb-4 outline-none border-2 border-transparent focus:border-yellow-400">
        <input type="text" id="roomId" placeholder="Room ID (‡§ú‡•à‡§∏‡•á: test1)" class="w-full p-4 bg-slate-700 rounded-lg mb-6 outline-none border-2 border-transparent focus:border-yellow-400">
        <button onclick="joinGame()" id="join-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-slate-900 font-bold py-4 rounded-lg text-xl uppercase">Khel Shuru Karein</button>
    </div>

    <!-- Waiting -->
    <div id="waiting-screen" class="hidden text-center bg-slate-800 p-10 rounded-2xl border border-slate-700 shadow-xl">
        <div class="inline-block animate-bounce mb-4 text-5xl">‚è≥</div>
        <h2 class="text-2xl font-bold mb-2">Player 2 ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞...</h2>
        <p class="text-slate-400">Room ID: <span id="display-room" class="text-yellow-400 font-mono"></span></p>
    </div>

    <!-- Game -->
    <div id="game-screen" class="hidden w-full max-w-xl">
        <div class="flex justify-between items-center mb-6 bg-slate-800 p-4 rounded-xl border border-slate-700">
            <div class="text-center px-4">
                <div id="p1-name" class="text-xs uppercase text-slate-400">P1</div>
                <div id="p1-score" class="text-3xl font-black text-green-400">0</div>
            </div>
            <div class="text-xl font-black text-slate-500">VS</div>
            <div class="text-center px-4">
                <div id="p2-name" class="text-xs uppercase text-slate-400">P2</div>
                <div id="p2-score" class="text-3xl font-black text-green-400">0</div>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-2xl shadow-lg border border-slate-700 mb-6">
            <div class="flex justify-between mb-4">
                <span class="text-yellow-400 font-bold">Q <span id="q-num">1</span>/30</span>
            </div>
            <h2 id="q-text" class="text-xl font-bold mb-6 min-h-[80px]">Sawaal load ho raha hai...</h2>
            <div id="options" class="grid grid-cols-1 gap-3"></div>
        </div>

        <button id="slap-btn" onclick="sendSlap()" disabled class="slap-btn w-full py-5 rounded-2xl text-2xl font-black shadow-xl opacity-30 cursor-not-allowed">üëã THAPPAD MAAREIN!</button>
        <p id="hint" class="text-center mt-4 text-slate-500 italic">Sahi jawab dein tabhi thappad maar payenge!</p>
    </div>

    <script>
        const API_URL = "https://sheetdb.io/api/v1/hkzyjglo32xu3";
        let state = { room: "", me: "", myName: "", qIdx: -1, busy: false };

        const questions = [
            { q: "‚Äò‡§ö‡§ø‡§®‡•ç‡§§‡§æ‡§Æ‡§£‡§ø‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§ï‡•å‡§® ‡§π‡•à‡§Ç?", opts: ["‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§∂‡•ç‡§Ø‡§æ‡§Æ‡§∏‡•Å‡§®‡•ç‡§¶‡§∞ ‡§¶‡§æ‡§∏", "‡§Ü‡§ö‡§æ‡§∞‡•ç‡§Ø ‡§∞‡§æ‡§Æ‡§ö‡§®‡•ç‡§¶‡•ç‡§∞ ‡§∂‡•Å‡§ï‡•ç‡§≤", "‡§ó‡•Å‡§≤‡§æ‡§¨‡§∞‡§æ‡§Ø"], ans: 2 },
            { q: "‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§Ø‡•Å‡§ó ‡§ï‡•Ä ‡§∏‡§Æ‡§Ø‡§æ‡§µ‡§ß‡§ø ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?", opts: ["1900-1920", "1919-1938", "1938-1947", "1850-1900"], ans: 1 },
            { q: "‚Äò‡§ó‡§¨‡§®‚Äô ‡§ï‡§ø‡§∏ ‡§µ‡§ø‡§ß‡§æ ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§®‡§æ‡§ü‡§ï", "‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏", "‡§ï‡§π‡§æ‡§®‡•Ä", "‡§ú‡•Ä‡§µ‡§®‡•Ä"], ans: 1 },
            { q: "‚Äò‡§ß‡•ç‡§∞‡•Å‡§µ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§®‡•Ä‚Äô ‡§®‡§æ‡§ü‡§ï ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§π‡•à‡§Ç?", opts: ["‡§π‡§∞‡§ø‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡•ç‡§∞‡•á‡§Æ‡•Ä", "‡§ú‡§Ø‡§∂‡§Ç‡§ï‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶", "‡§µ‡§ø‡§∑‡•ç‡§£‡•Å ‡§™‡•ç‡§∞‡§≠‡§æ‡§ï‡§∞", "‡§Æ‡•ã‡§π‡§® ‡§∞‡§æ‡§ï‡•á‡§∂"], ans: 1 },
            { q: "‚Äò‡§ï‡§≤‡§Æ ‡§ï‡§æ ‡§∏‡§ø‡§™‡§æ‡§π‡•Ä‚Äô ‡§ï‡§ø‡§∏‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§Ö‡§Æ‡•É‡§§‡§∞‡§æ‡§Ø", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§Ø‡§∂‡§™‡§æ‡§≤", "‡§®‡§ø‡§∞‡§æ‡§≤‡§æ"], ans: 0 },
            { q: "‚Äò‡§Æ‡•á‡§∞‡•Ä ‡§Ö‡§∏‡§´‡§≤‡§§‡§æ‡§è‡§Å‚Äô ‡§ï‡§ø‡§∏ ‡§µ‡§ø‡§ß‡§æ ‡§ï‡•Ä ‡§∞‡§ö‡§®‡§æ ‡§π‡•à?", opts: ["‡§ú‡•Ä‡§µ‡§®‡•Ä", "‡§Ü‡§§‡•ç‡§Æ‡§ï‡§•‡§æ", "‡§ï‡§π‡§æ‡§®‡•Ä", "‡§°‡§æ‡§Ø‡§∞‡•Ä"], ans: 1 },
            { q: "‚Äò‡§¨‡§æ‡§£‡§≠‡§ü‡•ç‡§ü ‡§ï‡•Ä ‡§Ü‡§§‡•ç‡§Æ‡§ï‡§•‡§æ‚Äô ‡§ï‡•á ‡§≤‡•á‡§ñ‡§ï ‡§π‡•à‡§Ç?", opts: ["‡§π‡§ú‡§æ‡§∞‡•Ä ‡§™‡•ç‡§∞‡§∏‡§æ‡§¶ ‡§¶‡•ç‡§µ‡§ø‡§µ‡•á‡§¶‡•Ä", "‡§∂‡•Å‡§ï‡•ç‡§≤", "‡§Ö‡§ú‡•ç‡§û‡•á‡§Ø", "‡§Ø‡§∂‡§™‡§æ‡§≤"], ans: 0 },
            { q: "‚Äò‡§ó‡•Å‡§®‡§æ‡§π‡•ã‡§Ç ‡§ï‡§æ ‡§¶‡•á‡§µ‡§§‡§æ‚Äô ‡§ï‡§ø‡§∏‡§®‡•á ‡§≤‡§ø‡§ñ‡§æ?", opts: ["‡§ß‡§∞‡•ç‡§Æ‡§µ‡•Ä‡§∞ ‡§≠‡§æ‡§∞‡§§‡•Ä", "‡§ï‡§Æ‡§≤‡•á‡§∂‡•ç‡§µ‡§∞", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§®‡§æ‡§ó‡§∞"], ans: 0 },
            { q: "‚Äò‡§∏‡•Ç‡§∞‡§ú ‡§ï‡§æ ‡§∏‡§æ‡§§‡§µ‡§æ‡§Å ‡§ò‡•ã‡§°‡§º‡§æ‚Äô ‡§ï‡§ø‡§∏‡§ï‡•Ä ‡§ï‡•É‡§§‡§ø ‡§π‡•à?", opts: ["‡§Æ‡•ã‡§π‡§® ‡§∞‡§æ‡§ï‡•á‡§∂", "‡§ß‡§∞‡•ç‡§Æ‡§µ‡•Ä‡§∞ ‡§≠‡§æ‡§∞‡§§‡•Ä", "‡§Ö‡§ú‡•ç‡§û‡•á‡§Ø", "‡§Ø‡§∂‡§™‡§æ‡§≤"], ans: 1 },
            { q: "‚Äò‡§Æ‡•à‡§≤‡§æ ‡§Ü‡§Å‡§ö‡§≤‚Äô ‡§ï‡§ø‡§∏‡§ï‡§æ ‡§â‡§™‡§®‡•ç‡§Ø‡§æ‡§∏ ‡§π‡•à?", opts: ["‡§´‡§£‡•Ä‡§∂‡•ç‡§µ‡§∞‡§®‡§æ‡§• ‡§∞‡•á‡§£‡•Å", "‡§™‡•ç‡§∞‡•á‡§Æ‡§ö‡§Ç‡§¶", "‡§Ö‡§Æ‡•É‡§§‡§∞‡§æ‡§Ø", "‡§®‡§æ‡§ó‡§æ‡§∞‡•ç‡§ú‡•Å‡§®"], ans: 0 }
        ]; // Space bachane ke liye 10 sawaal rakhe hain, aap 30 kar sakte hain

        async function joinGame() {
            const name = document.getElementById('username').value.trim();
            const room = document.getElementById('roomId').value.trim();
            if(!name || !room) return Swal.fire("Rukiye!", "Naam aur Room ID zaroori hai", "warning");

            state.myName = name;
            state.room = room;
            document.getElementById('display-room').innerText = room;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('waiting-screen').classList.remove('hidden');

            try {
                const res = await fetch(`${API_URL}/search?room_id=${room}`);
                const data = await res.json();
                
                if(data.length === 0) {
                    state.me = "player_1";
                    await fetch(API_URL, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({data: [{
                            room_id: room, player_1_name: name, player_2_name: "",
                            p1_score: 0, p2_score: 0, current_question_index: 0,
                            player_1_action: "none", player_2_action: "none"
                        }]})
                    });
                } else if(data[0].player_2_name === "") {
                    state.me = "player_2";
                    await fetch(`${API_URL}/room_id/${room}`, {
                        method: 'PATCH',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({data: {player_2_name: name}})
                    });
                } else {
                    Swal.fire("Full!", "Ye room full ho chuka hai", "error");
                    location.reload();
                }
                startSync();
            } catch(e) {
                Swal.fire("API Error", "Limit khatam ho gayi shayad. Kal try karein.", "error");
            }
        }

        function startSync() {
            // API bachane ke liye 3.5 seconds ka interval
            setInterval(async () => {
                if(state.busy) return;
                try {
                    const res = await fetch(`${API_URL}/search?room_id=${state.room}`);
                    const data = await res.json();
                    if(data.length > 0) syncUI(data[0]);
                } catch(e) {}
            }, 3500);
        }

        function syncUI(db) {
            if(db.player_1_name && db.player_2_name) {
                document.getElementById('waiting-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                document.getElementById('p1-name').innerText = db.player_1_name;
                document.getElementById('p2-name').innerText = db.player_2_name;
                document.getElementById('p1-score').innerText = db.p1_score;
                document.getElementById('p2-score').innerText = db.p2_score;

                const dbQIdx = parseInt(db.current_question_index);
                if(dbQIdx !== state.qIdx) {
                    state.qIdx = dbQIdx;
                    renderQuestion(dbQIdx);
                }

                // Action logic
                const oppAction = (state.me === "player_1") ? db.player_2_action : db.player_1_action;
                if(oppAction === "slap") handleIncomingSlap();
            }
        }

        function renderQuestion(idx) {
            if(idx >= questions.length) {
                document.getElementById('q-text').innerText = "Khel Khatam! üéâ";
                document.getElementById('options').innerHTML = "";
                return;
            }
            const q = questions[idx];
            document.getElementById('q-num').innerText = idx + 1;
            document.getElementById('q-text').innerText = q.q;
            const container = document.getElementById('options');
            container.innerHTML = "";
            q.opts.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 bg-slate-700 hover:bg-slate-600 rounded-xl border border-slate-600 transition";
                btn.innerText = opt;
                btn.onclick = () => {
                    if(i === q.ans) {
                        document.getElementById('slap-btn').disabled = false;
                        document.getElementById('slap-btn').style.opacity = "1";
                        document.getElementById('slap-btn').style.cursor = "pointer";
                        document.getElementById('hint').innerText = "SAHI JAWAB! AB THAPPAD MAARO!";
                        document.getElementById('hint').className = "text-center mt-4 text-green-400 font-bold";
                        container.querySelectorAll('button').forEach(b => b.disabled = true);
                    } else {
                        btn.classList.add('bg-red-900', 'border-red-500');
                        container.querySelectorAll('button').forEach(b => b.disabled = true);
                        document.getElementById('hint').innerText = "GALAT! Agle sawaal ka intezaar karein.";
                    }
                };
                container.appendChild(btn);
            });
        }

        async function sendSlap() {
            state.busy = true;
            const slapBtn = document.getElementById('slap-btn');
            slapBtn.disabled = true;
            slapBtn.style.opacity = "0.3";
            
            const curP1 = parseInt(document.getElementById('p1-score').innerText);
            const curP2 = parseInt(document.getElementById('p2-score').innerText);

            let payload = { current_question_index: state.qIdx + 1 };
            if(state.me === "player_1") {
                payload.player_1_action = "slap";
                payload.p1_score = curP1 + 10;
            } else {
                payload.player_2_action = "slap";
                payload.p2_score = curP2 + 10;
            }

            try {
                await fetch(`${API_URL}/room_id/${state.room}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({data: payload})
                });
            } catch(e) {}
            state.busy = false;
        }

        async function handleIncomingSlap() {
            document.getElementById('main-body').classList.add('shake-effect');
            setTimeout(() => document.getElementById('main-body').classList.remove('shake-effect'), 500);
            
            // Reset action in DB so it doesn't trigger again
            let reset = {};
            reset[state.me === "player_1" ? "player_2_action" : "player_1_action"] = "none";
            
            try {
                await fetch(`${API_URL}/room_id/${state.room}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({data: reset})
                });
            } catch(e) {}
        }
    </script>
</body>
</html>

