<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz & Slap Multiplayer</title>
    <!-- Tailwind CSS рдбрд┐рдЬрд╛рдЗрди рдХреЗ рд▓рд┐рдП -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SweetAlert2 рдЕрдЪреНрдЫреЗ рдкреЙрдкрдЕрдк рдХреЗ рд▓рд┐рдП -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* рдПрдиреАрдореЗрд╢рди: рдЬрдм рдердкреНрдкреЬ (Slap) рдкреЬреЗ рддреЛ рд╕реНрдХреНрд░реАрди рд╣рд┐рд▓рдиреА рдЪрд╛рд╣рд┐рдП */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .shake-effect {
            animation: shake 0.5s;
            animation-iteration-count: 1;
            border: 5px solid red; /* рд▓рд╛рд▓ рдмреЙрд░реНрдбрд░ рддрд╛рдХрд┐ рдЪреЛрдЯ рдХрд╛ рдЕрд╣рд╕рд╛рд╕ рд╣реЛ */
        }

        /* Slap рдмрдЯрди рдХрд╛ рд╕реНрдЯрд╛рдЗрд▓ */
        .slap-btn {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.4);
            transition: transform 0.1s;
        }
        .slap-btn:active {
            transform: scale(0.95);
        }
        .slap-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center font-sans" id="main-body">

    <!-- 1. рд▓реЙрдЧрд┐рди рд╕реНрдХреНрд░реАрди -->
    <div id="login-screen" class="w-full max-w-md p-6 bg-gray-800 rounded-xl shadow-2xl text-center">
        <h1 class="text-3xl font-bold mb-6 text-yellow-400">ЁЯСЛ Quiz & Slap</h1>
        <div class="space-y-4">
            <input type="text" id="username" placeholder="рдЕрдкрдирд╛ рдирд╛рдо (Player Name)" class="w-full p-3 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:border-yellow-400">
            <input type="text" id="roomId" placeholder="Room ID (e.g. room1)" class="w-full p-3 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:border-yellow-400">
            <button onclick="joinGame()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 rounded transition">рдЧреЗрдо рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ (Join)</button>
        </div>
        <p class="mt-4 text-xs text-gray-400">Player 1 рдкрд╣рд▓реЗ рд░реВрдо рдмрдирд╛рдПрдЧрд╛, рдлрд┐рд░ Player 2 рдЙрд╕реА ID рд╕реЗ рдЬреНрд╡рд╛рдЗрди рдХрд░реЗрдЧрд╛ред</p>
    </div>

    <!-- 2. рд╡реЗрдЯрд┐рдВрдЧ рд╕реНрдХреНрд░реАрди -->
    <div id="waiting-screen" class="hidden w-full max-w-md p-6 bg-gray-800 rounded-xl text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-yellow-400 mx-auto mb-4"></div>
        <h2 class="text-xl font-semibold">рджреВрд╕рд░реЗ рдЦрд┐рд▓рд╛рдбрд╝реА рдХрд╛ рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВ...</h2>
        <p id="waiting-msg" class="text-gray-400 mt-2">рдХреГрдкрдпрд╛ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдВ</p>
    </div>

    <!-- 3. рдЧреЗрдо рд╕реНрдХреНрд░реАрди -->
    <div id="game-screen" class="hidden w-full max-w-lg p-4">
        <!-- рд╕реНрдХреЛрд░ рдмреЛрд░реНрдб -->
        <div class="flex justify-between items-center bg-gray-800 p-4 rounded-lg mb-6 border border-gray-700">
            <div class="text-center">
                <p id="p1-name-display" class="text-sm text-gray-400">Player 1</p>
                <p id="p1-score-display" class="text-2xl font-bold text-green-400">0</p>
            </div>
            <div class="text-2xl font-bold text-red-500">VS</div>
            <div class="text-center">
                <p id="p2-name-display" class="text-sm text-gray-400">Player 2</p>
                <p id="p2-score-display" class="text-2xl font-bold text-green-400">0</p>
            </div>
        </div>

        <!-- рдХреНрд╡рд┐рдЬ рдПрд░рд┐рдпрд╛ -->
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6 relative">
            <span id="turn-indicator" class="absolute top-2 right-2 text-xs bg-blue-600 px-2 py-1 rounded">Loading...</span>
            <h3 id="question-text" class="text-xl font-semibold mb-6 min-h-[60px]">рд╕рд╡рд╛рд▓ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...</h3>
            
            <div id="options-container" class="grid grid-cols-1 gap-3">
                <!-- рдСрдкреНрд╢рдиреНрд╕ JS рд╕реЗ рдпрд╣рд╛рдБ рдЖрдПрдВрдЧреЗ -->
            </div>
        </div>

        <!-- рдПрдХреНрд╢рди рдмрдЯрди (SLAP) -->
        <div class="text-center">
            <button id="slap-btn" onclick="performSlap()" disabled class="slap-btn w-full py-4 rounded-xl text-2xl font-black text-white uppercase tracking-widest opacity-50">
                ЁЯСЛ SLAP ENEMY!
            </button>
            <p id="action-status" class="mt-2 text-sm text-gray-400 h-5">рд╕рд╣реА рдЬрд╡рд╛рдм рджреЗрдВ рдФрд░ рдердкреНрдкреЬ рдорд╛рд░реЗрдВ!</p>
        </div>
    </div>

    <script>
        // --- рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рд╕реНрдЯреЗрдЯ ---
        const API_URL = "https://sheetdb.io/api/v1/hkzyjglo32xu3";
        
        // рдЧреЗрдо рдХрд╛ рд╕реНрдЯреЗрдЯ (Local State)
        let gameState = {
            roomId: "",
            myPlayer: "", // 'player_1' рдпрд╛ 'player_2'
            myName: "",
            opponentName: "",
            isGameRunning: false,
            canSlap: false,
            currentQIndex: 0
        };

        // рдХреНрд╡рд┐рдЬ рдХреЗ рд╕рд╡рд╛рд▓ (рд╣рд╛рд░реНрдбрдХреЛрдбреЗрдб рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП)
        const questions = [
            { q: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдХреНрдпрд╛ рд╣реИ?", opts: ["рдореБрдВрдмрдИ", "рдирдИ рджрд┐рд▓реНрд▓реА", "рдХреЛрд▓рдХрд╛рддрд╛", "рдЪреЗрдиреНрдирдИ"], ans: 1 },
            { q: "рдХрдВрдкреНрдпреВрдЯрд░ рдХрд╛ рджрд┐рдорд╛рдЧ рдХрд┐рд╕реЗ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ?", opts: ["RAM", "Monitor", "CPU", "Mouse"], ans: 2 },
            { q: "H2O рдХрд┐рд╕рдХрд╛ рд░рд╛рд╕рд╛рдпрдирд┐рдХ рд╕реВрддреНрд░ рд╣реИ?", opts: ["рдСрдХреНрд╕реАрдЬрди", "рдкрд╛рдиреА", "рдирдордХ", "рд▓реЛрд╣рд╛"], ans: 1 },
            { q: "рдХреНрд░рд┐рдХреЗрдЯ рдЯреАрдо рдореЗрдВ рдХрд┐рддрдиреЗ рдЦрд┐рд▓рд╛рдбрд╝реА рд╣реЛрддреЗ рд╣реИрдВ?", opts: ["10", "12", "11", "9"], ans: 2 },
            { q: "рд╕реМрд░рдордВрдбрд▓ рдХрд╛ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЧреНрд░рд╣ рдХреМрди рд╕рд╛ рд╣реИ?", opts: ["рдкреГрдереНрд╡реА", "рд╢рдирд┐", "рдмреГрд╣рд╕реНрдкрддрд┐ (Jupiter)", "рдордВрдЧрд▓"], ans: 2 },
            { q: "JavaScript рдХрд┐рд╕ рддрд░рд╣ рдХреА рднрд╛рд╖рд╛ рд╣реИ?", opts: ["Scripting", "Cooking", "Driving", "None"], ans: 0 },
            { q: "HTML рдХрд╛ рдкреВрд░рд╛ рдирд╛рдо рдХреНрдпрд╛ рд╣реИ?", opts: ["Hyper Text Mix Lang", "High Tech Main Lab", "Hyper Text Markup Language", "None"], ans: 2 },
            { q: "рд╕рдмрд╕реЗ рддреЗрдЬ рджреМрдбрд╝рдиреЗ рд╡рд╛рд▓рд╛ рдЬрд╛рдирд╡рд░?", opts: ["рд╢реЗрд░", "рдЪреАрддрд╛", "рдШреЛрдбрд╝рд╛", "рд╣рд┐рд░рдг"], ans: 1 }
        ];

        // --- API рд╣реЗрд▓реНрдкрд░реНрд╕ (рдбреЗрдЯрд╛ рд▓рд╛рдирд╛ рдФрд░ рднреЗрдЬрдирд╛) ---

        // рд╢реАрдЯ рд╕реЗ рдбреЗрдЯрд╛ рд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП (GET)
        async function getGameData(roomId) {
            try {
                // API рд▓рд┐рдорд┐рдЯ рдмрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рд╕рд░реНрдЪ рдХреНрд╡реЗрд░реА рдХрд╛ рдпреВреЫ рдХрд░реЗрдВрдЧреЗ
                const response = await fetch(`${API_URL}/search?room_id=${roomId}`);
                const data = await response.json();
                return data.length > 0 ? data[0] : null;
            } catch (error) {
                console.error("API Error:", error);
                return null;
            }
        }

        // рдбреЗрдЯрд╛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (PATCH)
        async function updateGameData(roomId, dataObj) {
            try {
                await fetch(`${API_URL}/room_id/${roomId}`, {
                    method: 'PATCH',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: dataObj })
                });
            } catch (error) {
                console.error("Update Error:", error);
            }
        }

        // --- рдЧреЗрдо рд▓реЙрдЬрд┐рдХ ---

        // 1. рдЧреЗрдо рдЬреНрд╡рд╛рдЗрди рдХрд░рдирд╛
        async function joinGame() {
            const name = document.getElementById('username').value.trim();
            const room = document.getElementById('roomId').value.trim();

            if (!name || !room) {
                Swal.fire('Error', 'рдХреГрдкрдпрд╛ рдирд╛рдо рдФрд░ Room ID рджреЛрдиреЛрдВ рднрд░реЗрдВ!', 'error');
                return;
            }

            gameState.myName = name;
            gameState.roomId = room;

            // рд▓реЛрдбрд┐рдВрдЧ рджрд┐рдЦрд╛рдПрдВ
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('waiting-screen').classList.remove('hidden');

            const roomData = await getGameData(room);

            if (!roomData) {
                // рд░реВрдо рдирд╣реАрдВ рд╣реИ, рддреЛ рдирдпрд╛ рд░реВрдо рдмрдирд╛рдПрдВ (Player 1)
                gameState.myPlayer = 'player_1';
                document.getElementById('waiting-msg').innerText = "рд░реВрдо рдмрди рдЧрдпрд╛ рд╣реИред рджреВрд╕рд░реЗ рдкреНрд▓реЗрдпрд░ рдХрд╛ рдЗрдВрддрдЬрд╝рд╛рд░...";
                
                await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        data: [{
                            room_id: room,
                            player_1_name: name,
                            player_2_name: "",
                            player_1_action: "none",
                            player_2_action: "none",
                            p1_score: 0,
                            p2_score: 0,
                            current_question_index: 0
                        }]
                    })
                });
                startPolling();

            } else if (roomData.player_2_name === "") {
                // рд░реВрдо рд╣реИ рд▓реЗрдХрд┐рди P2 рдЦрд╛рд▓реА рд╣реИ, рддреЛ рдЬреНрд╡рд╛рдЗрди рдХрд░реЗрдВ (Player 2)
                gameState.myPlayer = 'player_2';
                document.getElementById('waiting-msg').innerText = "рд░реВрдо рдорд┐рд▓ рдЧрдпрд╛! рдХрдиреЗрдХреНрдЯ рд╣реЛ рд░рд╣рд╛ рд╣реИ...";
                
                await updateGameData(room, { player_2_name: name });
                startPolling();
            } else {
                Swal.fire('Oops!', 'рдпрд╣ рд░реВрдо рдкрд╣рд▓реЗ рд╕реЗ рднрд░рд╛ рд╣реБрдЖ рд╣реИ (Full Room)ред', 'warning');
                location.reload();
            }
        }

        // 2. рдкреЛрд▓рд┐рдВрдЧ (Polling) - рд╣рд░ 2 рд╕реЗрдХрдВрдб рдореЗрдВ рдбреЗрдЯрд╛ рд╕рд┐рдВрдХ рдХрд░рдирд╛
        function startPolling() {
            setInterval(async () => {
                const data = await getGameData(gameState.roomId);
                if (data) {
                    handleSync(data);
                }
            }, 2000); // 2 рд╕реЗрдХрдВрдб рдЕрдВрддрд░рд╛рд▓
        }

        // 3. рдбреЗрдЯрд╛ рд╕рд┐рдВрдХ рд╣реЛрдиреЗ рдкрд░ UI рдЕрдкрдбреЗрдЯ рдХрд░рдирд╛
        function handleSync(data) {
            // рдЕрдЧрд░ рджреЛрдиреЛрдВ рдкреНрд▓реЗрдпрд░ рдЖ рдЧрдП, рддреЛ рдЧреЗрдо рджрд┐рдЦрд╛рдПрдВ
            if (data.player_1_name && data.player_2_name && !gameState.isGameRunning) {
                gameState.isGameRunning = true;
                gameState.opponentName = (gameState.myPlayer === 'player_1') ? data.player_2_name : data.player_1_name;
                
                document.getElementById('waiting-screen').classList.add('hidden');
                document.getElementById('game-screen').classList.remove('hidden');
                
                // UI рдирд╛рдо рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ
                document.getElementById('p1-name-display').innerText = data.player_1_name;
                document.getElementById('p2-name-display').innerText = data.player_2_name;
            }

            if (!gameState.isGameRunning) return;

            // рд╕реНрдХреЛрд░ рдЕрдкрдбреЗрдЯ
            document.getElementById('p1-score-display').innerText = data.p1_score;
            document.getElementById('p2-score-display').innerText = data.p2_score;

            // рд╕рд╡рд╛рд▓ рдЕрдкрдбреЗрдЯ (Index рдХреЗ рдЖрдзрд╛рд░ рдкрд░)
            const serverQIndex = parseInt(data.current_question_index) || 0;
            if (serverQIndex !== gameState.currentQIndex) {
                gameState.currentQIndex = serverQIndex;
                loadQuestion(serverQIndex);
                // рдирдпрд╛ рд╕рд╡рд╛рд▓ рдЖрддреЗ рд╣реА рд╕реНрд▓реИрдк рдмрдЯрди рдбрд┐рд╕реЗрдмрд▓ рдХрд░реЗрдВ рдФрд░ рд╕реНрдЯреЗрдЯрд╕ рд░рд┐рд╕реЗрдЯ рдХрд░реЗрдВ
                disableSlapBtn(); 
            } else if (document.getElementById('question-text').innerText === "рд╕рд╡рд╛рд▓ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...") {
                // рдкрд╣рд▓реА рдмрд╛рд░ рд▓реЛрдб
                loadQuestion(serverQIndex);
            }

            // --- рдердкреНрдкрдбрд╝ (SLAP) рдбрд┐рдЯреЗрдХреНрд╢рди рд▓реЙрдЬрд┐рдХ ---
            checkIncomingSlap(data);
        }

        // 4. рд╕рд╡рд╛рд▓ рд▓реЛрдб рдХрд░рдирд╛
        function loadQuestion(index) {
            if (index >= questions.length) {
                document.getElementById('question-text').innerText = "рдЧреЗрдо рд╕рдорд╛рдкреНрдд!";
                document.getElementById('options-container').innerHTML = "";
                return;
            }

            const q = questions[index];
            document.getElementById('question-text').innerText = q.q;
            const optsDiv = document.getElementById('options-container');
            optsDiv.innerHTML = "";

            q.opts.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-3 bg-gray-700 hover:bg-gray-600 rounded border border-gray-600 transition";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i, q.ans);
                optsDiv.appendChild(btn);
            });
        }

        // 5. рдЬрд╡рд╛рдм рдЪреЗрдХ рдХрд░рдирд╛
        function checkAnswer(selected, correct) {
            const status = document.getElementById('action-status');
            const optsDiv = document.getElementById('options-container');

            if (selected === correct) {
                // рд╕рд╣реА рдЬрд╡рд╛рдм -> Slap рдмрдЯрди рдЕрдирд▓реЙрдХ
                status.innerText = "рд╕рд╣реА рдЬрд╡рд╛рдм! рдЕрдм 'SLAP' рдмрдЯрди рджрдмрд╛рдУ!";
                status.className = "mt-2 text-sm text-green-400 font-bold h-5";
                
                const slapBtn = document.getElementById('slap-btn');
                slapBtn.disabled = false;
                slapBtn.classList.remove('opacity-50');
                
                // рдСрдкреНрд╢рди рдмрдЯрди рд▓реЙрдХ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдмрд╛рд░-рдмрд╛рд░ рди рджрдмрд╛ рд╕рдХреЗ
                 Array.from(optsDiv.children).forEach(b => b.disabled = true);
            } else {
                // рдЧрд▓рдд рдЬрд╡рд╛рдм -> рдкреЗрдирд▓реНрдЯреА рдпрд╛ рдЗрдВрддрдЬрд╝рд╛рд░
                status.innerText = "рдЧрд▓рдд рдЬрд╡рд╛рдм! рдореМрдХрд╛ рдЧрдпрд╛ред";
                status.className = "mt-2 text-sm text-red-400 h-5";
                Array.from(optsDiv.children).forEach(b => b.disabled = true);
                
                // рдереЛрдбрд╝реА рджреЗрд░ рдмрд╛рдж рдЦреБрдж рдХреЛ "рд░реЗрдбреА" рдХрд░рдиреЗ рдХрд╛ рд▓реЙрдЬрд┐рдХ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, 
                // рд▓реЗрдХрд┐рди рдЕрднреА рдХреЗ рд▓рд┐рдП рд╣рдо рдЕрдЧрд▓реЗ рд╕рд╡рд╛рд▓ рдХрд╛ рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░реЗрдВрдЧреЗ
            }
        }

        // 6. рдердкреНрдкрдбрд╝ рдорд╛рд░рдирд╛ (Action рднреЗрдЬрдирд╛)
        async function performSlap() {
            // рдмрдЯрди рджрдмрд╛рддреЗ рд╣реА рдбрд┐рд╕реЗрдмрд▓ рдХрд░реЗрдВ
            disableSlapBtn();
            
            // рдЖрд╡рд╛рдЬрд╝ (рд╡реИрдХрд▓реНрдкрд┐рдХ)
            // let audio = new Audio('slap_sound.mp3'); audio.play();

            document.getElementById('action-status').innerText = "рдЖрдкрдиреЗ рдердкреНрдкрдбрд╝ рдорд╛рд░рд╛! (Sending...)";

            // рдбреЗрдЯрд╛рдмреЗрд╕ рдЕрдкрдбреЗрдЯ: рд╕реНрдХреЛрд░ рдмрдврд╝рд╛рдирд╛ рдФрд░ Action рд╕реЗрдЯ рдХрд░рдирд╛
            // рдЕрдЧрд▓рд╛ рд╕рд╡рд╛рд▓ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП index рднреА рдмрдврд╝рд╛рдПрдВ
            let updates = {};
            
            if (gameState.myPlayer === 'player_1') {
                const currentScore = parseInt(document.getElementById('p1-score-display').innerText);
                updates = {
                    player_1_action: 'slap',
                    p1_score: currentScore + 10,
                    current_question_index: gameState.currentQIndex + 1
                };
            } else {
                const currentScore = parseInt(document.getElementById('p2-score-display').innerText);
                updates = {
                    player_2_action: 'slap',
                    p2_score: currentScore + 10,
                    current_question_index: gameState.currentQIndex + 1
                };
            }

            await updateGameData(gameState.roomId, updates);
        }

        // 7. рдердкреНрдкрдбрд╝ рдЦрд╛рдирд╛ (Action рд░рд┐рд╕реАрд╡ рдХрд░рдирд╛)
        async function checkIncomingSlap(data) {
            let opponentAction = "";
            let resetKey = "";

            if (gameState.myPlayer === 'player_1') {
                opponentAction = data.player_2_action; // P1 рджреЗрдЦреЗрдЧрд╛ P2 рдиреЗ рдХреНрдпрд╛ рдХрд┐рдпрд╛
                resetKey = "player_2_action";
            } else {
                opponentAction = data.player_1_action; // P2 рджреЗрдЦреЗрдЧрд╛ P1 рдиреЗ рдХреНрдпрд╛ рдХрд┐рдпрд╛
                resetKey = "player_1_action";
            }

            if (opponentAction === 'slap') {
                // рд╕реНрдХреНрд░реАрди рд╣рд┐рд▓рд╛рдПрдВ (Shake Effect)
                const body = document.getElementById('main-body');
                body.classList.add('shake-effect');
                
                // Toast рдиреЛрдЯрд┐рдлрд┐рдХреЗрд╢рди
                Swal.fire({
                    icon: 'error',
                    title: 'Ouch!',
                    text: `${gameState.opponentName} рдиреЗ рдЖрдкрдХреЛ рдердкреНрдкрдбрд╝ рдорд╛рд░рд╛!`,
                    timer: 1500,
                    showConfirmButton: false,
                    toast: true,
                    position: 'top-end'
                });

                // рдПрдиреАрдореЗрд╢рди рд╣рдЯрд╛рдиреЗ рдХреЗ рд▓рд┐рдП timeout
                setTimeout(() => {
                    body.classList.remove('shake-effect');
                }, 600);

                // рдЕрдм рд╣рдореЗрдВ DB рдореЗрдВ рдлреНрд▓реИрдЧ рд░рд┐рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рддрд╛рдХрд┐ рдмрд╛рд░-рдмрд╛рд░ рдердкреНрдкрдбрд╝ рди рдкрдбрд╝реЗ
                // "victim" рдпрд╛рдиреА рдЬрд┐рд╕реЗ рдердкреНрдкрдбрд╝ рд▓рдЧрд╛, рд╡реЛ DB рд╕рд╛рдлрд╝ рдХрд░реЗрдЧрд╛ (acknowledgement)
                let resetUpdate = {};
                resetUpdate[resetKey] = "none";
                await updateGameData(gameState.roomId, resetUpdate);
            }
        }

        function disableSlapBtn() {
            const btn = document.getElementById('slap-btn');
            btn.disabled = true;
            btn.classList.add('opacity-50');
            document.getElementById('action-status').innerText = "рд╕рд╣реА рдЬрд╡рд╛рдм рджреЗрдВ рдФрд░ рдердкреНрдкреЬ рдорд╛рд░реЗрдВ!";
            document.getElementById('action-status').className = "mt-2 text-sm text-gray-400 h-5";
        }

    </script>
</body>
</html>

